<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Galeasso - Verifica</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.socket.io/4.7.4/socket.io.min.js" integrity="sha384-Gr6Lu2Ajx28mzwyVR8CFkULdCU7kMlZ9UthllibdOSo6qAiN+yXNHqtgdTvFXMT4" crossorigin="anonymous"></script> 
<link rel="stylesheet" href="./style.css">

<script>
	// Variabili globali
	let socket;
	let nick;

	function connetti() {
		nick = document.getElementById('nick').value;
		const ip = document.getElementById('ip').value;

		// Connessione al server
		socket = io.connect(ip);

		if(ip == "" || nick == ""){
			alert("Errore!")
		} else{
			alert("Utente " + nick + " connesso!")
			// Invio del nickname al server
			socket.emit('invionick', { nick });

			// Gestione degli eventi ricevuti dal server
			socket.on('elenconick', (nicknames) => {
				console.log('Elenco Nicknames:', nicknames);
			});

			socket.on('elencomagazzino', (magazzino) => {
				updateMagazzino(magazzino);
				alert("Magazzino aggiornato!")
			});
		}
	}

	// Funzione per aggiornare la visualizzazione del magazzino
	function updateMagazzino(magazzino) {
		const listaProdotti = document.getElementById('listaProdotti');
		listaProdotti.innerHTML = '';
		magazzino.forEach((item) => {
			listaProdotti.innerHTML += `<p><strong>${item.nick}</strong><br/><i>Nome:</i> ${item.nome}<br/><i>Prezzo:</i> ${item.prezzo}<br/><i>Quantità:</i> ${item.quantita}<br/><i>Ubicazione:</i> ${item.ubicazione}</p>`;
		});
	}

	// Funzione per inserire un nuovo prodotto
	function inviaProdotto() {
		const nome = document.getElementById('nome').value;
		const prezzo = document.getElementById('prezzo').value;
		const quantita = document.getElementById('quantita').value;
		const ubicazione = document.getElementById('ubicazione').value;

		if(nome == "" || prezzo == "" || quantita == "" || ubicazione == ""){
			alert("Devi compilare tutti i campi!")
		} else{
			socket.emit('inviaProdotto', { nick, nome, prezzo, quantita, ubicazione });
		}
	}

	// Funzione per rimuovere un prodotto dal magazzino
	function rimuoviProdotto() {
		const nomeDaRimuovere = document.getElementById('rimuoviProdottoInput').value;
		if(nomeDaRimuovere == ""){
			alert("Inserisci un nome da rimuovere!")
		} else{
			socket.emit('rimuoviProdotto', nomeDaRimuovere);
		}
	}

	// Funzione per cercare un prodotto dal magazzino
	function cercaProdotto() {
		const nomeDaCercare = document.getElementById('cercaProdottoInput').value;
		if(nomeDaCercare == ""){
			alert("Inserisci un nome da cercare!")
		} else{
			socket.emit('cercaProdotto', nome);
		}
	}
</script>

</head>
<body>
	<div class="container-all">
		<div class="container form-container">
			<div class="form">
				<div class="form-group">
					<label for="ip">Inserisci IP:</label>
					<input type="text" id="ip" placeholder="Indirizzo IP" class="input-box" value="http://172.10.194.220:3000"/>
				</div>
				<div class="form-group">
					<label for="nick">Inserisci cognome:</label>
					<input type="text" id="nick" placeholder="Nickname" class="input-box" value="Galeasso"/>
				</div>
				<a href="#magazzino"><button onclick="connetti()" class="btn-invia">Connetti</button></a>
			</div>
		</div>
	</div>
	<!-- <hr /> -->
	<div class="container-all">
		<div id="magazzino">
			<h1 class="text-left mb-5">Magazzino</h1>

			<!-- Visualizzazione dei prodotti -->
			<div id="listaProdotti"></div>

			<!-- Inserimento dei prodotti -->
			<div class="form-group">
				<div class="row d-flex">
					<div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<input type="text" id="nome" placeholder="Nome prodotto" class="input-box" value="mela"/>
					</div>
					<div class="col col-xl-3 col-lg-2 col-md-2 col-sm-12 col-xs-12">
						<input type="text" id="prezzo" placeholder="Prezzo prodotto" class="input-box" value="1"/>
					</div>
					<div class="col col-xl-3  col-lg-2 col-md-2 col-sm-12 col-xs-12">
						<input type="text" id="quantita" placeholder="Quantità prodotto" class="input-box" value="1"/>
					</div>
					<div class="col col-xl-3  col-lg-2 col-md-2 col-sm-12 col-xs-12">
						<input type="text" id="ubicazione" placeholder="Ubicazione prodotto" class="input-box" value="1"/>
					</div>
					<div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 col-xs-12">
						<button onclick="inviaProdotto()" class="btn-invia mb-5">Inserisci</button>
					</div>
				</div>
			</div>

			<!-- Rimozione dei prodotti -->
			<div class="form-group mb-2">
				<div class="row">
					<div class="col-xl-9 col-lg-9 col-md-9 col-sm-12 col-xs-12">
						<input type="text" id="rimuoviProdottoInput" placeholder="Nome prodotto da rimuovere" class="input-box" />
					</div>
					<div class="col-xl-3 col-lg-3 col-md-3 col-sm-12 col-xs-12">
						<button onclick="rimuoviProdotto()" class="btn-invia">Rimuovi</button>
					</div>
				</div>
			</div>

			<!-- RIcerca dei prodotti -->
			<div class="form-group">
				<div class="row">
					<div class="col-xl-9 col-lg-9 col-md-9 col-sm-12 col-xs-12">
						<input type="text" id="cercaProdottoInput" placeholder="Nome prodotto da cercare" class="input-box" />
					</div>
					<div class="col-xl-3 col-lg-3 col-md-3 col-sm-12 col-xs-12">
						<button onclick="cercaProdotto()" class="btn-invia">Cerca</button>
					</div>
				</div>
			</div>
	</div>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
</body>
</html>