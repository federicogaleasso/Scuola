<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galeasso ArcadeV1</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>

    <script>
        let config = {
            //configurazione
            type: Phaser.AUTO,
            width: 1200,
            height: 700,
            backgroundColor: 0x000000,
            parent: "contenitore",
            // pixelArt: true,

            //fisica
            physics: {
                default: "arcade",
                arcade: {
                    gravity: {
                        y: 400
                    },
                    debug: false
                },
            },

            scene: {

                preload: car,
                create: cre,
                update: up
            }
        };

        let game = new Phaser.Game(config);

        function car() {
            this.load.image('sfondo', './assets/background.png');
            this.load.image('entrata', './assets/tubo.jpg');
            this.load.image('uscita', './assets/tubo.jpg');
            this.load.image('omino', './assets/sprite.png');
            this.load.image('erba', './assets/floor.png');
            this.load.image('cuori', './assets/tomato_item.png');
            this.load.image('logo', './assets/logo.png');
        }

        function cre() {
            this.add.image(600, 350, 'sfondo').setScale(2);
            this.intro = this.add.image(600, 300, 'logo').setScale(3);
            this.omino = this.physics.add.sprite(900, 520, 'omino').setScale(5).setCollideWorldBounds(true);
            //impostazioni erba
            this.erba = this.physics.add.staticGroup({
                key: 'erba',
                repeat: 1,
                setXY: {
                    x: 290,
                    y: 680,
                    stepX: 645
                },
                setScale: {
                    x: 1.2,
                    y: 1.5
                }
            });
            //impostazioni portale entrata
            this.entrata = this.physics.add.staticGroup({
                    key: 'entrata',
                    setXY: {
                        x: 130,
                        y: 565
                    },
                    setScale: {
                        x: 1,
                        y: 1
                    }
                })
                //impostazioni portale uscita
            this.uscita = this.physics.add.staticGroup({
                    key: 'uscita',
                    setXY: {
                        x: 1050,
                        y: 630
                    },
                    setScale: {
                        x: 1,
                        y: 1
                    }
                })
                //impostazioni cuori
            this.cuori = this.physics.add.group({
                key: 'cuori',
                repeat: 5,
                setXY: {
                    x: 300,
                    y: 0,
                    stepX: 100
                },
                setScale: {
                    x: 2,
                    y: 2
                }
            });
            this.erba.setDepth(10);
            this.cuori.setDepth(10);
            this.physics.add.collider(this.erba, this.omino);
            this.physics.add.collider(this.erba, this.cuori);
            this.tasto = this.input.keyboard.createCursorKeys();

            this.miaAnim = this.tweens.createTimeline()
            this.miaAnim.add({
                targets: [this.omino],
                duration: 3000,
                ease: "elastic",
                x: 1000
            })
            this.miaAnim.play();

            this.cuori.children.iterate(function(child) {
                child.setBounceY(Phaser.Math.FloatBetween(0.3, 0.5));
            });

            this.physics.add.collider(this.omino, this.entrata, (omino, entrata) => {
                omino.setVisible(false);
                omino.setPosition(1050, 400);
                omino.setVisible(true);
            })

            //controllo e aumento punti
            let punti = 0;
            let puntitxt = this.add.text(16, 16, 'Score: 0', {
                fontSize: '40px',
                color: '#7300bf'
            });
            this.physics.add.collider(this.omino, this.cuori, (omino, cuori) => {
                cuori.disableBody(true, true);
                punti += 1;
                puntitxt.setText("Score: " + punti);
            });
        }

        function up() {
            if (this.tasto.right.isDown) {
                this.omino.setVelocityX(300);
                this.intro.setVisible(false);
            } else {
                if (this.tasto.left.isDown) {
                    this.omino.setVelocityX(-300);
                } else {
                    if (Phaser.Input.Keyboard.JustDown(this.tasto.space)) {
                        this.omino.setVelocityY(-400);
                        this.intro.setVisible(false);
                    } else {
                        this.omino.setVelocityX(0);
                    }
                }
            }
        }
    </script>
</head>

<body>
    <div id="contenitore"></div>

</body>

</html>